# Node 管理页面功能说明

## 功能概览

Node 管理页面现在支持完整的 Node.js 环境管理功能，包括版本切换、包管理器管理和全局包管理。

---

## 1. 版本切换功能 ✅

### 已安装版本列表

在"已安装版本"区域，你可以看到所有已安装的 Node.js 版本。

**功能：**
- ✅ 显示所有已安装版本
- ✅ 高亮显示当前激活版本
- ✅ 显示版本来源（nvm/fnm/volta）
- ✅ **点击卡片即可切换版本**

**使用方法：**
1. 找到想要切换的版本卡片
2. 点击卡片（非激活版本会显示"点击切换"提示）
3. 确认切换对话框
4. 等待切换完成
5. 页面自动刷新显示新版本

**示例：**
```
┌─────────────────┐  ┌─────────────────┐
│ ● v20.19.5      │  │   v18.17.0      │  ← 点击这里切换
│   当前使用      │  │   点击切换      │
│   [nvm]         │  │   [nvm]         │
└─────────────────┘  └─────────────────┘
```

**注意：**
- 切换版本会根据当前使用的版本管理工具自动执行对应命令
- nvm: `nvm use <version>`
- fnm: `fnm use <version>`
- volta: `volta pin node@<version>`

---

## 2. 包管理器管理 ✅

### 支持的包管理器

- **npm** - 随 Node.js 安装，不支持单独安装/更新
- **pnpm** - 支持安装和更新
- **yarn** - 支持安装和更新

**功能：**
- ✅ 显示安装状态和版本号
- ✅ **点击安装未安装的包管理器**
- ✅ **点击更新已安装的包管理器**
- ✅ 自动检测版本

**使用方法：**

### 安装包管理器
1. 找到显示"未安装"的包管理器卡片
2. 点击卡片（会显示"点击安装"提示）
3. 确认安装对话框
4. 等待安装完成
5. 页面自动刷新显示新版本

### 更新包管理器
1. 找到已安装的包管理器卡片
2. 点击卡片（会显示"点击更新"提示）
3. 确认更新对话框
4. 等待更新完成
5. 页面自动刷新显示新版本

**示例：**
```
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│    npm      │  │    pnpm     │  │    yarn     │
│  v10.8.2    │  │  v9.15.9    │  │   未安装    │
│             │  │  点击更新   │  │  点击安装   │  ← 点击安装
└─────────────┘  └─────────────┘  └─────────────┘
```

**实现原理：**
- 安装: `npm install -g <package-manager>`
- 更新: `npm update -g <package-manager>`

---

## 3. 全局包管理 ✅

### 全局包列表

显示所有通过 npm 全局安装的包。

**功能：**
- ✅ 显示包名和版本
- ✅ **复制包名到剪贴板**
- ✅ **卸载全局包**

**使用方法：**

### 复制包名
1. 找到要复制的包
2. 点击右侧的"复制"图标 📋
3. 包名已复制到剪贴板

### 卸载全局包
1. 找到要卸载的包
2. 点击右侧的"删除"图标 🗑️
3. 确认卸载对话框
4. 等待卸载完成
5. 页面自动刷新

**示例：**
```
┌────────────────────────────────────────┐
│ 📦 typescript                          │
│    v5.3.3                              │
│                          [📋] [🗑️]    │  ← 复制/卸载
└────────────────────────────────────────┘
```

**实现原理：**
- 卸载: `npm uninstall -g <package-name>`

---

## 4. 版本管理工具切换 ✅

### 切换入口

有两个地方可以切换版本管理工具：

1. **顶部工具栏** - 右上角的切换图标 (⇄)
2. **当前版本卡片** - 版本管理工具名称旁的"切换"按钮

**功能：**
- ✅ 自动检测当前工具
- ✅ 保存当前状态（版本、全局包）
- ✅ 完整卸载旧工具
- ✅ 自动安装新工具
- ✅ 恢复所有版本
- ✅ 切换到之前的版本

详见：[NODE_TOOL_SWITCH_GUIDE.md](./NODE_TOOL_SWITCH_GUIDE.md)

---

## 交互设计

### 视觉反馈

1. **悬停效果**
   - 可点击的卡片会显示悬停效果
   - 鼠标指针变为手型

2. **加载状态**
   - 所有操作都会显示加载对话框
   - 显示当前操作进度

3. **确认对话框**
   - 所有危险操作（切换、卸载）都需要确认
   - 清晰说明操作内容

4. **成功/失败提示**
   - 操作完成后显示 SnackBar 提示
   - 成功：绿色提示
   - 失败：红色提示，显示错误信息

### 自动刷新

所有操作完成后，页面会自动刷新环境信息，确保显示最新状态。

---

## 快捷操作总结

| 操作 | 位置 | 方式 |
|------|------|------|
| 切换 Node 版本 | 已安装版本卡片 | 点击卡片 |
| 切换版本管理工具 | 顶部工具栏 / 版本卡片 | 点击切换按钮 |
| 安装包管理器 | 包管理器卡片 | 点击未安装的卡片 |
| 更新包管理器 | 包管理器卡片 | 点击已安装的卡片 |
| 复制包名 | 全局包列表 | 点击复制图标 |
| 卸载全局包 | 全局包列表 | 点击删除图标 |
| 刷新页面 | 顶部工具栏 | 点击刷新按钮 |

---

## 技术实现

### 服务层方法

**NodeMigrationService:**
```dart
// 版本切换
Future<bool> switchNodeVersion(NodeVersionManagerType tool, String version, Function(String) onLog)

// 包管理器
Future<bool> installPackageManager(String name)
Future<bool> updatePackageManager(String name)
Future<String?> checkPackageManagerUpdate(String name)

// 全局包
Future<bool> uninstallGlobalPackage(String name)
```

### 状态管理

使用 Riverpod 的 `StateNotifierProvider` 管理 Node 环境状态：
```dart
final nodeEnvironmentProvider = StateNotifierProvider<NodeEnvironmentNotifier, AsyncValue<NodeEnvironment>>
```

所有操作完成后调用 `refresh()` 方法刷新状态。

---

## 常见问题

### Q: 切换版本后终端还是旧版本？
A: 需要重启终端窗口，环境变量才会生效。

### Q: 包管理器更新失败？
A: 检查网络连接，或尝试手动执行 `npm update -g <package-manager>`。

### Q: 卸载全局包后还能看到？
A: 刷新页面，或检查是否有多个 Node 版本安装了同一个包。

### Q: npm 为什么不能更新？
A: npm 随 Node.js 安装，更新 npm 需要更新 Node.js 或使用 `npm install -g npm@latest`（不推荐）。

---

## 未来计划

- [ ] 批量操作（批量安装/卸载全局包）
- [ ] 全局包更新检测
- [ ] 版本推荐（LTS、最新版）
- [ ] 导出/导入全局包列表
- [ ] 版本对比功能
- [ ] 性能监控

---

**享受便捷的 Node.js 环境管理！** 🚀
