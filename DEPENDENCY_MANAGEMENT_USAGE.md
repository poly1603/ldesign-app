# 依赖管理功能使用指南

## ✅ 已完成实现

完整的依赖管理功能已经实现！包含以下所有功能：

### 核心功能
1. ✅ **依赖列表显示** - 自动读取 package.json 并显示所有依赖
2. ✅ **分类筛选** - 全部/生产依赖/开发依赖
3. ✅ **搜索功能** - 按包名搜索
4. ✅ **添加新依赖** - 支持指定版本和类型（dev/prod）
5. ✅ **删除依赖** - 带确认对话框
6. ✅ **升级依赖** - 一键升级到最新版本
7. ✅ **切换版本** - 切换到任意指定版本
8. ✅ **版本信息** - 显示配置版本、已安装版本、最新版本

### 自动功能
- ✅ 自动检测包管理器（npm/yarn/pnpm）
- ✅ 自动获取已安装版本
- ✅ 自动获取最新版本
- ✅ 加载状态显示
- ✅ 错误处理和用户反馈

## 🚀 如何使用

### 1. 查看依赖列表

进入依赖管理页面后，会自动加载项目的所有依赖：

- **蓝色标签 (PROD)** - 生产依赖
- **橙色标签 (DEV)** - 开发依赖  
- **绿色标签 (UPDATE)** - 有新版本可用

每个依赖显示：
- 包名
- 配置版本（package.json中的版本）
- 已安装版本（node_modules中的实际版本）
- 最新版本（npm registry中的最新版本）

### 2. 搜索依赖

在顶部搜索框输入包名即可实时过滤依赖列表。

### 3. 筛选依赖

使用三个按钮筛选：
- **全部** - 显示所有依赖
- **生产** - 只显示 dependencies
- **开发** - 只显示 devDependencies

### 4. 添加新依赖

1. 点击右上角绿色的"➕ 添加依赖"按钮
2. 输入包名（必填），例如：`lodash`
3. 输入版本（可选），例如：`^4.17.21`，留空则安装最新版
4. 勾选"开发依赖"复选框（如果是devDependency）
5. 点击"安装"按钮

系统会：
- 显示安装进度
- 自动检测使用的包管理器（npm/yarn/pnpm）
- 执行安装命令
- 显示成功或失败消息
- 自动刷新依赖列表

### 5. 删除依赖

1. 找到要删除的依赖
2. 点击右侧的红色 🗑️ 删除按钮
3. 在确认对话框中点击"删除"
4. 等待删除完成

### 6. 升级依赖到最新版本

如果依赖有新版本可用（显示绿色UPDATE标签）：

1. 点击绿色 ⬆️ 升级按钮
2. 查看升级信息（当前版本 → 最新版本）
3. 确认升级
4. 等待升级完成

### 7. 切换到指定版本

如果需要切换到特定版本：

1. 点击蓝色 🔄 切换版本按钮
2. 在对话框中输入目标版本，例如：
   - `1.2.3` - 精确版本
   - `^2.0.0` - 兼容版本
   - `latest` - 最新版本
3. 点击"切换"
4. 等待版本切换完成

## 📝 技术细节

### 支持的包管理器

系统会自动检测项目使用的包管理器：

1. **pnpm** - 检测 `pnpm-lock.yaml`
2. **yarn** - 检测 `yarn.lock`
3. **npm** - 检测 `package-lock.json`
4. **默认** - 如果都没有，使用 npm

### 文件位置

- 依赖管理界面：`lib/screens/dependency_management_screen.dart`
- 依赖服务：`lib/services/dependency_service.dart`

### 代码统计

- 依赖管理界面：655 行
- 依赖服务：293 行
- 总计：948 行代码

## ⚠️ 注意事项

1. **需要 Node.js 环境** - 操作依赖需要系统安装 npm
2. **需要 package.json** - 项目必须有 package.json 文件
3. **网络连接** - 获取最新版本需要访问 npm registry
4. **权限** - 安装/删除依赖需要文件写入权限

## 🔧 故障排除

### 问题：显示"加载失败"

**原因**：
- 项目路径不存在
- 没有 package.json 文件
- 文件权限问题

**解决方案**：
- 检查项目路径是否正确
- 确保项目根目录有 package.json
- 检查文件访问权限

### 问题：无法安装依赖

**原因**：
- 网络连接问题
- npm/yarn/pnpm 未安装
- 包名错误
- 版本号格式错误

**解决方案**：
- 检查网络连接
- 确保系统安装了包管理器
- 验证包名和版本号格式

### 问题：未显示最新版本

**原因**：
- 网络请求失败
- npm registry 连接问题
- 请求被限流

**解决方案**：
- 点击刷新按钮重新加载
- 检查网络连接
- 等待一段时间后重试

## 🎯 使用建议

1. **定期检查更新** - 点击刷新按钮查看是否有新版本
2. **谨慎升级** - 升级前查看更新日志，避免破坏性更改
3. **版本锁定** - 重要项目使用精确版本而非范围版本
4. **批量操作** - 一次性处理多个依赖更新
5. **测试验证** - 更新后及时测试项目功能

## 📊 界面说明

### 顶部操作栏
- 返回按钮 (←) - 返回项目详情
- 项目图标和名称
- "添加依赖"按钮（绿色）
- "刷新"按钮 (🔄)

### 搜索和筛选栏
- 搜索框 - 实时搜索
- 分段按钮 - 全部/生产/开发

### 依赖卡片
每个依赖显示为一个卡片，包含：
- 包名和类型标签
- 版本信息（配置/已安装/最新）
- 操作按钮（升级/切换/删除）

### 底部状态栏
- 显示"正在获取版本信息..."时表示后台加载中

## 🚀 下一步计划

虽然核心功能已完成，但还可以扩展：

- [ ] .npmrc 配置编辑器
- [ ] 依赖树可视化
- [ ] 批量操作（批量升级）
- [ ] 安全漏洞检查
- [ ] 依赖分析报告
- [ ] 依赖冲突检测

---

**现在就可以开始使用依赖管理功能了！** 🎉
